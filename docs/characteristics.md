# Характеристики объекта автоматизации

## Системные интерфейсы

<p>Продукт предоставляет единую точку входа для всех клиентских приложений через API Gateway и взаимодействует с рядом внешних систем для выполнения бизнес-процессов.</p>

Интерфейс с внешними системами (через соответствующие сервисы бэкенда):

- Интерфейс с Платежным шлюзом (payment_gateway): Обеспечивает безопасное проведение финансовых транзакций. Сервис Оплаты (ServicePayment) отправляет данные для списания и получает подтверждение/отказ.
- Интерфейс с Роботизированным комплексом (robot_system): Управление автоматизированным приготовлением. Сервис Робототехники (ServiceRobotics) отправляет технологические карты и команды, получает статусы оборудования.
- Интерфейс с Системой складского учета (warehouse_system): Синхронизация данных об остатках ингредиентов и товаров. Сервис Меню (ServiceMenu) может запрашивать или получать обновления по остаткам.
- Интерфейс с Фискальным терминалом (cash): Регистрация наличных платежей в соответствии с 54-ФЗ. Сервис Оплаты (ServicePayment) формирует и отправляет фискальные данные.

## Пользовательские интерфейсы

Логические характеристики интерфейсов определены для каждой категории пользователей:

- Покупатели (infomat, web_app, mobil_app): Минималистичный, интуитивно понятный интерфейс для просмотра меню, формирования заказа, выбора способа оплаты и отслеживания статуса. Приоритет – скорость и простота.
- Сотрудники/Администраторы (Admin_web_app): Интерфейс с расширенным функционалом: управление меню, ценообразование, просмотр статистики, управление заказами, мониторинг работы роботов. Требуется аутентификация и разграничение прав.
- Кассиры (1С): Специализированный, регламентированный интерфейс, интегрированный в среду 1С, для быстрого оформления заказов и приема платежей в точке продаж.

## Аппаратные интерфейсы

- Интерфейс с роботизированным комплексом: Взаимодействие через промышленные протоколы связи (например, OPC UA, Modbus TCP) или REST/HTTP API, предоставляемое производителем роботов. Характеризуется набором команд (старт/стоп, загрузка рецепта, запрос статуса) и подпиской на события от оборудования.
- Интерфейс с фискальным терминалом: Взаимодействие через драйверы и API, соответствующие ФФД 1.2 (Федеральный формат фискальных данных). Протокол включает команды на регистрацию чека, печать отчета и запрос статуса ФН.

## Программные интерфейсы

| № п/п | Наименование | Источник | Назначение |
|-------|--------------|----------|------------|
|PostgreSQL|Open Source|Система управления реляционными базами данных для всех сервисов|
|Apache Kafka|Apache Foundation|Брокер сообщений для асинхронной межсервисной коммуникации|
|Java Runtime Environment|Oracle/OpenJDK|Среда выполнения для сервисов на Spring Boot|
|Node.js|OpenJS Foundation|Среда выполнения для сервиса API Gateway|

## Внутренние программные интерфейсы (API):

- REST API (синхронный): Основной стиль взаимодействия между API Gateway и внутренними сервисами (ServiceOrder, ServiceMenu, ServicePayment и др.), а также между фронтенд-приложениями и бэкендом. Использует JSON в качестве формата данных. Аутентификация через JWT-токены, валидируемые API Gateway и ServiceAutorisation.

- Event-Driven API (асинхронный): Реализован через Apache Kafka. Используется для фоновых и неблокирующих операций (например, после создания заказа ServiceOrder публикует событие OrderCreated, на которое подписываются ServiceStatistics и ServiceMessage). Формат сообщений – Apache Avro или JSON Schema.

## Интерфейсы связи

- Внешние коммуникации: HTTPS/TLS 1.2+ для всех публичных API, предоставляемых API Gateway. Протоколы взаимодействия с внешними системами определяются их контрактами (REST, SOAP, AMQP).

- Внутренние коммуникации: HTTP/2 или gRPC для синхронного взаимодействия между микросервисами внутри защищенного периметра. Apache Kafka (протокол TCP) для асинхронного обмена событиями.

## Интерфейсы со службами (SaaS/Cloud)

- Сервис отправки SMS/Push-уведомлений: ServiceMessage взаимодействует с внешним SaaS-провайдером (например, Twilio, Firebase Cloud Messaging) через REST API для отправки сообщений конечным пользователям.

- Облачное хранилище: Для хранения статических файлов (изображений блюд, логотипов) используется облачное объектное хранилище (например, AWS S3, Yandex Object Storage) через соответствующее SDK.

- Мониторинг и логирование: Все сервисы интегрируются с облачными сервисами мониторинга (Prometheus/Grafana) и агрегации логов (ELK Stack, Loki), размещенными в инфраструктуре.

## Ограничения

- Технические: Терминалы самообслуживания работают на ОС Windows 11 IoT/LTSB. Платежный шлюз предоставляет только REST API. Роботизированные комплексы имеют proprietary API на C++.

- Бизнес-ограничения: Срок реализации — 12 месяцев. Бюджет разработки — не более 100 млн руб. Первый пилот должен быть запущен в г. Москва.

- Нормативные: Система должна соответствовать ФЗ-54 «О применении ККТ», требованиям PCI DSS (уровень SAQ A) для обработки платежных данных, ГОСТ Р 54762-2011/ISO 9241-210 по эргономике.

## Допущения и зависимости

- Допущения: Заказчик обеспечит стабильный высокоскоростной канал связи (не менее 100 Мбит/с) на площадке. Поставляемое заказчиком оборудование (роботы, терминалы) будет сертифицировано и работоспособно.

- Зависимости: Сроки реализации зависят от своевременного предоставления заказчиком спецификаций и API от поставщиков роботизированных комплексов. Работа платежного модуля зависит от внешних сервисов провайдера.