# Компонентная архитектура

## Обоснование выбора архитектурного стиля

Проектируемая система автоматизации ресторана включает ключевой пользовательский сценарий — оформление заказа через клиентское табло (инфомат). От надежности и производительности этого сценария напрямую зависит удовлетворенность посетителей и, в конечном счете, выручка. Микросервисная архитектура выбрана как оптимальный способ обеспечения бесперебойной работы функциональности заказа при одновременном соблюдении требований масштабируемости, отказоустойчивости и гибкости всей системы. Ниже перечислены основные преимущества данного подхода применительно к сервису заказов и его взаимодействию с табло. Преимущества такой системы:

- Гибкость: Микросервисы могут быть разработаны и развернуты независимо друг от друга, что позволяет быстро вносить изменения в приложение без необходимости перезапуска всего приложения.

- Масштабируемость критичного сценария заказа: В часы пиковой нагрузки (обеденное время, акции) количество запросов на оформление заказов через табло может многократно возрастать. Микросервисная архитектура позволяет независимо масштабировать горизонтально только те компоненты, которые участвуют в обработке заказа: API Gateway, ServiceOrder, ServicePayment, ServiceMenu, ServiceBonus. Остальные сервисы (например, ServiceStatistics или ServiceMessage) могут работать без выделения дополнительных ресурсов, что снижает затраты на инфраструктуру и сохраняет высокую скорость обработки заказов.

- Отказоустойчивость при сбоях в смежных подсистемах: Табло должно принимать и подтверждать заказы даже в случае временной недоступности второстепенных сервисов. Например, если возникнут проблемы с отправкой уведомлений (ServiceMessage) или задержки в обновлении статистики (ServiceStatistics), это никак не повлияет на возможность клиента оформить заказ. Благодаря изоляции сервисов, сбой в одном компоненте не приводит к каскадному отказу всей системы, что гарантирует доступность функции заказа.

- Асинхронная обработка фоновых операций без блокировки: После того как заказ успешно создан и оплачен, система должна выполнить ряд дополнительных действий: начислить бонусы, отправить подтверждение, обновить аналитику. В микросервисной архитектуре эти операции делегируются через брокер сообщений (Kafka) и обрабатываются асинхронно. Таким образом, табло мгновенно получает ответ об успешном оформлении заказа, а все фоновые процессы выполняются параллельно, не увеличивая время ожидания для посетителя.

- Независимое развитие и развертывание логики заказов: Бизнес-требования к процессу заказа могут меняться: добавляться новые способы оплаты, акции, правила расчёта бонусов или типы доставки. Микросервис ServiceOrder, отвечающий за жизненный цикл заказа, может дорабатываться и выкатываться в прод независимо от других частей системы. Это сокращает время вывода новых функций на табло и снижает риски, связанные с регрессионным тестированием всей системы.

- Интеграция с внешними системами без изменения ядра заказов: Для выполнения заказа требуются взаимодействия с платёжным шлюзом, фискальным регистратором, складской системой и роботизированным комплексом. Выделение отдельных сервисов для каждой интеграции (ServicePayment, интеграция с warehouse_system, robot_system) позволяет изолировать сложность внешних протоколов. Сервис заказов при этом остаётся сфокусированным на своей бизнес-логике и общается с интеграционными сервисами через чёткие контракты API или через брокер сообщений. Это упрощает поддержку и замену внешних поставщиков.

- Оптимальное управление данными заказов: Каждый микросервис владеет своей базой данных, что исключает неконтролируемый доступ к данным заказов со стороны других подсистем. ServiceOrder использует выделенную БД (DbOrders), что гарантирует целостность и безопасность информации о заказах. Другие сервисы получают только необходимые данные через API или события, что снижает связанность и упрощает аудит.

- Легкость разработки: Разработчики могут работать над отдельными микросервисами, что упрощает процесс разработки и тестирования.

## Диаграмма компонентов

На диаграмме представлены компоненты микросервисной архитектуры системы и интеграции между данными компонентами.

![](diagrams/C4Level3/C4Level3.svg)