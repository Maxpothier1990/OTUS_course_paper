# Компонентная архитектура

## Обоснование выбора архитектурного стиля

Проектируемая система автоматизации ресторана включает ключевой пользовательский сценарий — оформление заказа через клиентское табло (инфомат). От надежности и производительности этого сценария напрямую зависит удовлетворенность посетителей и, в конечном счете, выручка. Микросервисная архитектура выбрана как оптимальный способ обеспечения бесперебойной работы функциональности заказа при одновременном соблюдении требований масштабируемости, отказоустойчивости и гибкости всей системы. Ниже перечислены основные преимущества данного подхода применительно к сервису заказов и его взаимодействию с табло. Преимущества такой системы:

- Гибкость: Микросервисы могут быть разработаны и развернуты независимо друг от друга, что позволяет быстро вносить изменения в приложение без необходимости перезапуска всего приложения.

- Масштабируемость критичного сценария заказа: В часы пиковой нагрузки (обеденное время, акции) количество запросов на оформление заказов через табло может многократно возрастать. Микросервисная архитектура позволяет независимо масштабировать горизонтально только те компоненты, которые участвуют в обработке заказа: API Gateway, ServiceOrder, ServicePayment, ServiceMenu, ServiceBonus. Остальные сервисы (например, ServiceStatistics или ServiceMessage) могут работать без выделения дополнительных ресурсов, что снижает затраты на инфраструктуру и сохраняет высокую скорость обработки заказов.

- Отказоустойчивость при сбоях в смежных подсистемах: Табло должно принимать и подтверждать заказы даже в случае временной недоступности второстепенных сервисов. Например, если возникнут проблемы с отправкой уведомлений (ServiceMessage) или задержки в обновлении статистики (ServiceStatistics), это никак не повлияет на возможность клиента оформить заказ. Благодаря изоляции сервисов, сбой в одном компоненте не приводит к каскадному отказу всей системы, что гарантирует доступность функции заказа.

- Асинхронная обработка фоновых операций без блокировки: После того как заказ успешно создан и оплачен, система должна выполнить ряд дополнительных действий: начислить бонусы, отправить подтверждение, обновить аналитику. В микросервисной архитектуре эти операции делегируются через брокер сообщений (Kafka) и обрабатываются асинхронно. Таким образом, табло мгновенно получает ответ об успешном оформлении заказа, а все фоновые процессы выполняются параллельно, не увеличивая время ожидания для посетителя.

- Независимое развитие и развертывание логики заказов: Бизнес-требования к процессу заказа могут меняться: добавляться новые способы оплаты, акции, правила расчёта бонусов или типы доставки. Микросервис ServiceOrder, отвечающий за жизненный цикл заказа, может дорабатываться и выкатываться в прод независимо от других частей системы. Это сокращает время вывода новых функций на табло и снижает риски, связанные с регрессионным тестированием всей системы.

- Интеграция с внешними системами без изменения ядра заказов: Для выполнения заказа требуются взаимодействия с платёжным шлюзом, фискальным регистратором, складской системой и роботизированным комплексом. Выделение отдельных сервисов для каждой интеграции (ServicePayment, интеграция с warehouse_system, robot_system) позволяет изолировать сложность внешних протоколов. Сервис заказов при этом остаётся сфокусированным на своей бизнес-логике и общается с интеграционными сервисами через чёткие контракты API или через брокер сообщений. Это упрощает поддержку и замену внешних поставщиков.

- Оптимальное управление данными заказов: Каждый микросервис владеет своей базой данных, что исключает неконтролируемый доступ к данным заказов со стороны других подсистем. ServiceOrder использует выделенную БД (DbOrders), что гарантирует целостность и безопасность информации о заказах. Другие сервисы получают только необходимые данные через API или события, что снижает связанность и упрощает аудит.

- Легкость разработки: Разработчики могут работать над отдельными микросервисами, что упрощает процесс разработки и тестирования.

## Диаграмма компонентов

На диаграмме представлены компоненты микросервисной архитектуры системы и интеграции между данными компонентами.

![](diagrams/C4Level3/C4Level3.svg)

## Описание компонентов

| № п/п | Тип       | Наименование                            | Технологии          | Описание                                                                                  |
|-------|-----------|-----------------------------------------|----------------------|-------------------------------------------------------------------------------------------|
| 1     | Container | Табло клиентского зала                  | JavaScript / React  | Интерфейс для покупателей в ресторане (инфомат)                                           |
| 2     | Container | Веб-интерфейс для покупателей           | JavaScript          | Личный кабинет и возможность заказа через веб                                              |
| 3     | Container | Мобильный интерфейс для покупателей     | Android             | Мобильное приложение для заказа и отслеживания                                            |
| 4     | Container | Веб-интерфейс для сотрудников           | JavaScript          | Административная панель для управления заказами, меню и т.д.                              |
| 5     | Container | Касса                                   | 1С                  | Интерфейс кассира для приема заказов и оплаты                                             |
| 6     | Container | API Gateway                             | -                   | Единая точка входа, маршрутизация, аутентификация, rate limiting, кеширование, мониторинг |
| 7     | Container | Сервис авторизации                      | Spring Security     | Управление пользователями, JWT-токены, ролевая модель                                     |
| 8     | Container | БД пользователей                        | PostgreSQL          | Хранение данных пользователей и ролей                                                     |
| 9     | Container | Сервис управления роботизированным комплексом | Spring Boot    | Настройка технологических карт, мониторинг статуса роботов и производства                 |
| 10    | Container | Сервис оплаты                           | Spring Boot         | Интеграция с платежными системами, обработка транзакций, чеки, возвраты                   |
| 11    | Container | БД оплаты                               | PostgreSQL          | Данные о платежах и транзакциях                                                           |
| 12    | Container | Сервис меню                             | Spring Boot         | Управление каталогом блюд, ценами, акциями, остатками                                     |
| 13    | Container | БД меню                                 | PostgreSQL          | Данные о блюдах, ценах, ингредиентах                                                      |
| 14    | Container | Сервис уведомлений                      | Spring Boot         | Отправка SMS, push-уведомлений, управление шаблонами                                      |
| 15    | Container | БД уведомлений                          | PostgreSQL          | Хранение шаблонов и истории уведомлений                                                   |
| 16    | Container | Сервис заказов                          | Spring Boot         | Управление жизненным циклом заказов, оркестрация композитных операций                     |
| 17    | Container | БД заказов                              | PostgreSQL          | Данные о заказах                                                                          |
| 18    | Container | Бонусная система                        | Spring Boot         | Начисление и списание баллов, программа лояльности                                        |
| 19    | Container | БД системы лояльности                   | PostgreSQL          | Данные о бонусных счетах и транзакциях                                                    |
| 20    | Container | Сервис статистики                       | Spring Boot         | Сбор и анализ бизнес-метрик, отчеты, KPI                                                  |
| 21    | Container | Основная БД (статистика)                | PostgreSQL          | Хранение данных для аналитики и отчетов                                                   |
| 22    | Container | Сервис доставки                         | Spring Boot         | Управление доставками, маршрутизация, расчет сроков                                       |
| 23    | Container | БД доставки                             | PostgreSQL          | Данные о доставках и статусах                                                             |
| 24    | Container | Брокер сообщений                        | Apache Kafka        | Асинхронная коммуникация между сервисами для фоновых операций                             |

## Описание интеграционного взаимодействия

![](out\docs\diagrams\Sequence Diagram\OTUSСервисАвторизации\Autorisation.svg)

![](out\docs\diagrams\Sequence Diagram\OTUSСервисЗаказа\Make_order.svg)



