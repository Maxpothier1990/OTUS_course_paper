# Требования к системе

## Требования к системе в целом (Нефункциональные требования)

### Производительность

**`NFPER1`** Система должна обслуживать нем менее 100 пользователей в период пиковой активности с 8:00 до 22:00 по местному времени, со средней продолжительностью сеанса 5 минут.  

**`NFPER2`** Все веб-страницы, генерируемые системой, должны полностью загружаться не более чем за 5 секунды после запроса их по интернет-подключению со скоростью 20 Мбит/сек.  

**`NFPER3`** Система должна выводить пользователю сообщение о подтверждении в среднем за 3 секунды и не более чем через 6 секунд после того, как пользователь отослал информацию системе. 

**`NFPER4`** Система должна обрабатывать до 30 новых заказов в минуту в часы пик без деградации времени отклика, указанного в NFPER3.

**`NFPER5`** Время отклика системы на любом клиентском интерфейсе при пиковой нагрузке (100 одновременных активных сессий) не должно превышать 2 секунд в 95% запросов.

**`NFPER6`** В режиме технического обслуживания система должна позволять завершать текущие транзакции, но блокировать создание новых заказов.

### Удобство использования

**`NFUS1`** Покупатель должен иметь возможность оформить первый заказ без помощи персонала не более чем за 3 минуты.

**`NFUS2`** 95% пользователей должны успешно завершить ключевые сценарии (поиск блюда, добавление в корзину, оплата) без ошибок.

**`NFUS3`** Средний балл по шкале SUS (System Usability Scale) по результатам опроса пользователей клиентского приложения должен быть не менее 75 из 100.

**`NFUS4`** Интерфейс кассира в 1С должен блокировать возможность повторного применения скидки или отмены уже оплаченного заказа без двухуровневого подтверждения (вызов менеджера).

### Безопасность

**`NFSEC1`** Доступ к API должен осуществляться с обязательным использованием JWT-токенов. Должна быть реализована ролевая модель доступа (RBAC) для разделения прав сотрудников.

**`NFSEC2`** Все данные, передаваемые между клиентом и сервером, а также между микросервисами, должны шифроваться с использованием TLS 1.2 или выше. Пароли пользователей должны храниться в хэшированном виде (bcrypt).

**`NFSEC3`** API Gateway должен обеспечивать защиту от базовых атак (DDoS, подбор паролей, SQL-инъекции).

**`NFSEC4`** Доступ к персональным данным покупателей и истории их заказов должен быть строго регламентирован, все действия с данными должны логироваться.

**`NFSEC5`** Инфраструктура, обрабатывающая данные банковских карт (сервис оплаты), должна соответствовать требованиям PCI DSS уровня, применимого к используемому платежному шлюзу.

### Масштабируемость

**`NFSCAL1`** Архитектура системы (микросервисы) должна позволять горизонтально масштабировать каждый сервис независимо от других.

**`NFSCAL2`** Должна быть предусмотрена возможность увеличения количества партиций в топиках Apache Kafka и шардирования баз данных (например, по датам) для обработки растущего объёма данных.

**`NFSCAL3`** Система должна позволять добавлять новые способы оплаты, каналы уведомлений или модули (например, доставку) без изменения кода ядерных сервисов (через плагины или конфигурацию).

### Надежность

**`NFROB1`** Коэффициент готовности системы (доступность) должен составлять не менее 99,5% в течение календарного месяца.

**`NFROB2`** Средняя наработка на отказ (MTBF) для критического бизнес-контура (от создания заказа до его фиксации в БД) должна составлять не менее 720 часов.

**`NFROB3`** Критически важные компоненты (API Gateway, сервисы заказов и оплаты, основная база данных) должны быть развернуты в отказоустойчивой конфигурации (минимум 2 экземпляра).

**`NFROB4`** Если соединение между пользователем и системой разрывается до подтверждения заказа, система должна позволять восстановить незавершенный заказ и продолжить работу с того же шага.

### Совместимость

**`NFCOM1`** Клиентские веб-приложения должны корректно работать в последних версиях браузеров Chrome, Firefox, Safari и их мобильных аналогах.

**`NFCOM2`** Мобильное приложение должно быть совместимо с актуальными версиями ОС Android и iOS (на момент выхода приложения).

**`NFCOM3`** Бэкенд-сервисы должны быть упакованы в Docker-контейнеры, что позволяет разворачивать систему как в облачной инфраструктуре (Yandex Cloud, AWS), так и в локальном дата-центре.

**`NFCOM4`** Интеграция с внешними системами (платежные шлюзы, роботизированный комплекс, 1С, ОФД) должна осуществляться через API, предоставляемые этими системами.

### Доступность

**`NFAVL1`** Система должна быть доступна не менее 99,5% времени в течение месяца (с учётом времени планового обслуживания).

**`NFAVL2`** Плановое техническое обслуживание (обновление, резервное копирование) не должно приводить к простою более 2 часов в месяц.

**`NFAVL3`** Среднее время восстановления системы (MTTR) после сбоя уровня «сервис недоступен» не должно превышать 15 минут.

### Хранения данных

**`NFDT1`** Персональные данные пользователей должны храниться не дольше срока, установленного законодательством (152-ФЗ), и удаляться после закрытия учётной записи.

**`NFDT2`** Фискальные данные (чеки) должны храниться не менее 5 лет в соответствии с требованиями ФЗ-54.

**`NFDT3`** Заказы старше 3 лет должны автоматически перемещаться в архивное (холодное) хранилище для снижения нагрузки на операционные базы данных.

**`NFDT4`** Полное резервное копирование всех баз данных должно выполняться ежедневно, инкрементальное — ежечасно.

**`NFDT5`** Резервные копии должны храниться в географически распределённом хранилище для обеспечения сохранности при авариях.

### Концептуальная целостность

**`NFARC1`** Для синхронного взаимодействия между компонентами системы должен использоваться архитектурный стиль REST. Для асинхронного обмена — событийно-ориентированная архитектура на базе Apache Kafka.

**`NFARC2`** Все сервисы должны быть слабосвязанными и взаимодействовать через единую точку входа — API Gateway.

**`NFARC3`** Каждый микросервис должен быть независимым и иметь собственную базу данных (если требуется). 

### Поддерживаемость

**`NFSUP1`** Система должна логировать действия пользователей, критические события и ошибки. Доступ к логам должен предоставляться через графический интерфейс с возможностью фильтрации и поиска.

**`NFSUP2`** Должен быть обеспечен мониторинг производительности и состояния сервисов в реальном времени (дашборды, алерты).

**`NFSUP3`** Время развертывания новой версии одного микросервиса (включая rolling update) не должно превышать 10 минут.

**`NFSUP4`** Код должен соответствовать принятым стандартам кодстайла, уровень покрытия unit-тестами критической бизнес-логики — не менее 80%.

**`NFSUP5`** Вся конфигурация (подключения к внешним системам, параметры) должна выноситься в централизованное хранилище (Config Server, Vault), а не храниться внутри образов контейнеров.

## Требования к функциям (задачам), выполняемым системой

### User Story mapping

Основные функции системы представлены в виде User story mapping.  

[[User story mapping](https://app.holst.so/share/b/88076e88-4e70-47f7-8d50-dead7810f132)]

#### Definition of Ready (DoR) – критерии готовности пользовательской истории к началу разработки:
- История оценена командой (story points/часы).
- Чётко сформулированы Acceptance Criteria.
- Все внешние зависимости (API, данные, доступы) определены и доступны.
- История согласована с заказчиком/продукт-оунером.
- Макет/дизайн (если требуется) утверждён и доступен.

#### Definition of Done (DoD) – критерии завершённости истории:
- Код написан, отревьюван и слит в основную ветку.
- Написаны автоматические тесты (unit/integration) с покрытием не менее 80% для новой логики.
- Проведено функциональное тестирование (вручную или автотестами).
- Документация (API, пользовательская) обновлена.
- История развёрнута на тестовом стенде и принята заказчиком/тестировщиком.
- Отсутствуют критические и высокие дефекты.


### Функции MVP (Minimum Viable Product)

| ID | User Story | Приоритет | Версия | Acceptance Criteria |
|----|------------|-----------|--------|---------------------|
| **US-01** | Я как **посетитель** хочу **ознакомиться с меню** (категории, состав, цена, фото), чтобы **выбрать подходящее блюдо**. | Высокий | MVP | 1. Отображаются все категории блюд.<br>2. В каждой категории показаны блюда с названием, ценой, фото и кратким описанием.<br>3. При клике на блюдо открывается детальная карточка с полным составом и возможностью добавления в корзину.<br>4. Данные меню загружаются не более 2 секунд. |
| **US-02** | Я как **посетитель** хочу **добавлять выбранные блюда в корзину**, чтобы **сформировать заказ**. | Высокий | MVP | 1. При нажатии «Добавить в корзину» блюдо появляется в корзине.<br>2. Счётчик товаров в иконке корзины увеличивается.<br>3. Если блюдо отсутствует (нет в наличии), кнопка неактивна и выводится сообщение.<br>4. После добавления предлагается апселлинг (популярные дополнения). |
| **US-03** | Я как **посетитель** хочу **просматривать содержимое корзины**, чтобы **видеть итоговый состав и стоимость заказа**. | Высокий | MVP | 1. В корзине отображается список добавленных позиций с фото, названием, количеством, ценой за единицу и общей суммой.<br>2. Итоговая стоимость заказа пересчитывается при любых изменениях.<br>3. Есть кнопка «Оформить заказ». |
| **US-04** | Я как **посетитель** хочу **удалять позиции из корзины**, чтобы **актуализировать заказ перед оплатой**. | Высокий | MVP | 1. Возле каждой позиции есть кнопка удаления.<br>2. При нажатии появляется подтверждение «Удалить позицию?».<br>3. После подтверждения позиция исчезает, сумма пересчитывается.<br>4. При удалении всех позиций отображается сообщение «Корзина пуста». |
| **US-05** | Я как **посетитель** хочу **выбрать способ получения заказа («в зале» или «с собой»)** , чтобы **получить заказ в удобном формате**. | Высокий | MVP | 1. На этапе оформления предлагаются две опции: «В зале» и «С собой».<br>2. Выбор обязателен, нельзя перейти к оплате без выбора.<br>3. Выбранный способ сохраняется и отображается в чеке/талоне. |
| **US-06** | Я как **посетитель** хочу **оплатить заказ банковской картой**, чтобы **завершить оформление и получить номер заказа**. | Высокий | MVP | 1. При выборе оплаты картой активируется платёжный терминал или открывается форма ввода данных.<br>2. При успешной оплате заказ создаётся, присваивается номер, печатается талон.<br>3. При ошибке оплаты выводится сообщение, предлагается повторить или выбрать другой способ.<br>4. Платежи проходят через тестовый/боевой шлюз без сохранения чувствительных данных. |
| **US-07** | Я как **посетитель** хочу **получить талон с номером заказа и QR-кодом**, чтобы **отслеживать готовность и получить заказ**. | Высокий | MVP | 1. После оплаты на экране отображается номер заказа и QR-код.<br>2. Есть возможность распечатать талон (на терминале) или сохранить QR в телефон.<br>3. Заказ отправляется на кухню, система фиксирует время начала приготовления. |
| **US-08** | Я как **менеджер** хочу **управлять меню** (изменять цены, описания, доступность блюд), чтобы **актуализировать информацию для посетителей**. | Высокий | MVP | 1. В админ-панели доступен список всех блюд с возможностью редактирования.<br>2. Можно изменить название, цену, описание, фото, скрыть/показать блюдо.<br>3. Изменения сохраняются и мгновенно отображаются в клиентских интерфейсах.<br>4. При попытке сохранить пустые обязательные поля или отрицательную цену выводится ошибка. |

### 5.2.2 Функции версии 2 (Ver 2)

| ID | User Story | Приоритет | Версия | Acceptance Criteria |
|----|------------|-----------|--------|---------------------|
| **US-09** | Я как **посетитель** хочу **авторизоваться в системе** (по номеру телефона), чтобы **использовать бонусную программу и получать персональные предложения**. | Средний | Ver 2 | 1. Вход по номеру телефона и паролю или по SMS-коду.<br>2. При неверных данных выводится сообщение.<br>3. После входа отображается имя пользователя, баланс бонусов.<br>4. Сессия сохраняется минимум 7 дней. |
| **US-10** | Я как **посетитель** хочу **зарегистрироваться в системе**, чтобы **получать бонусы за заказы**. | Средний | Ver 2 | 1. Форма регистрации: номер телефона, имя (опционально), пароль.<br>2. Подтверждение номера через SMS.<br>3. После подтверждения пользователь автоматически авторизуется.<br>4. Нельзя зарегистрироваться с уже существующим номером без восстановления. |
| **US-11** | Я как **посетитель** хочу **списывать накопленные бонусные баллы при оплате**, чтобы **получать скидку на заказ**. | Средний | Ver 2 | 1. На экране оплаты отображается текущий баланс и опция списания.<br>2. Можно ввести количество баллов или выбрать «Списать максимум».<br>3. Сумма заказа пересчитывается с учётом скидки (1 балл = 1 рубль или другой курс).<br>4. После оплаты начисляются новые баллы за заказ. |
| **US-12** | Я как **посетитель** хочу **оплатить заказ подарочной картой (gift card)** , чтобы **использовать подарочный сертификат**. | Средний | Ver 2 | 1. При выборе «Подарочная карта» предлагается ввести номер или отсканировать штрих-код.<br>2. Система проверяет баланс карты.<br>3. Если средств достаточно, списывает сумму и создаёт заказ.<br>4. Если недостаточно, предлагает доплатить другим способом. |
| **US-13** | Я как **менеджер** хочу **создавать и редактировать акции и комбо-предложения**, чтобы **повышать привлекательность меню для посетителей**. | Средний | Ver 2 | 1. В админ-панели раздел «Акции и комбо».<br>2. Можно создать акцию (процент скидки, фиксированная сумма, условие «от N позиций»).<br>3. Можно создать комбо (набор блюд со специальной ценой).<br>4. Акции применяются к корзине автоматически при выполнении условий. |
| **US-14** | Я как **работник производства** хочу **видеть текущую очередь заказов и статус их готовности**, чтобы **эффективно планировать работу**. | Средний | Ver 2 | 1. На рабочем месте доступен дашборд с активными заказами.<br>2. Заказы отсортированы по времени, виден состав и время до готовности.<br>3. При готовности работник отмечает заказ, статус меняется, клиент получает уведомление.<br>4. Дашборд обновляется в реальном времени. |
| **US-15** | Я как **работник производства** хочу **отслеживать остатки ингредиентов**, чтобы **своевременно пополнять запасы**. | Средний | Ver 2 | 1. В интерфейсе склада отображается список ингредиентов с текущим количеством и пороговыми значениями.<br>2. При достижении порога строка выделяется цветом.<br>3. Можно сформировать заявку на пополнение (интеграция с ERP или ручной заказ). |

### 5.2.3 Функции версии 3 (Ver 3)

| ID | User Story | Приоритет | Версия | Acceptance Criteria |
|----|------------|-----------|--------|---------------------|
| **US-16** | Я как **менеджер** хочу **оформлять возврат денежных средств (наличные или на карту)**, чтобы **обслужить клиента при отмене заказа**. | Низкий | Ver 3 | 1. В интерфейсе заказа доступна кнопка «Возврат».<br>2. При выборе возврата на карту система проводит транзакцию через платёжный шлюз.<br>3. При возврате наличными открывается денежный ящик.<br>4. Статус заказа меняется на «Возврат», фиксируется сумма и время. |
| **US-17** | Я как **менеджер** хочу **получать уведомления о технических сбоях** (отключение оборудования, ошибки системы), чтобы **оперативно реагировать**. | Низкий | Ver 3 | 1. При потере связи с роботом, терминалом или платежным шлюзом генерируется уведомление.<br>2. Уведомление приходит в интерфейс менеджера (и/или email/SMS).<br>3. В уведомлении указано описание проблемы и время возникновения.<br>4. При восстановлении статуса отправляется уведомление о разрешении. |
| **US-18** | Я как **работник кухни** хочу **получать уведомления о необходимости выдать готовый заказ**, чтобы **не задерживать выдачу**. | Низкий | Ver 3 | 1. Если заказ готов более 2 минут (настраиваемый интервал), система отправляет напоминание на терминал выдачи.<br>2. Уведомление дублируется звуковым сигналом.<br>3. После подтверждения выдачи уведомление исчезает. |

---

> **Примечание:** Приведённые User Story охватывают все уникальные сценарии из предоставленного материала. Повторяющиеся истории были объединены. DoR и DoD являются общими для всех историй и применяются ко всем задачам в рамках разработки. Acceptance Criteria для каждой истории конкретизируют условия успешной реализации.