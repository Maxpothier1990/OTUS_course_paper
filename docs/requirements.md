# Требования к системе

## Требования к системе в целом (Нефункциональные требования)

### Производительность

**`NFPER1`** Система должна обслуживать нем менее 100 пользователей в период пиковой активности с 8:00 до 22:00 по местному времени, со средней продолжительностью сеанса 5 минут.  

**`NFPER2`** Все веб-страницы, генерируемые системой, должны полностью загружаться не более чем за 5 секунды после запроса их по интернет-подключению со скоростью 20 Мбит/сек.  

**`NFPER3`** Система должна выводить пользователю сообщение о подтверждении в среднем за 3 секунды и не более чем через 6 секунд после того, как пользователь отослал информацию системе. 

**`NFPER4`** Система должна обрабатывать до 30 новых заказов в минуту в часы пик без деградации времени отклика, указанного в NFPER3.

**`NFPER5`** Время отклика системы на любом клиентском интерфейсе при пиковой нагрузке (100 одновременных активных сессий) не должно превышать 2 секунд в 95% запросов.

**`NFPER6`** В режиме технического обслуживания система должна позволять завершать текущие транзакции, но блокировать создание новых заказов.

### Удобство использования

**`NFUS1`** Покупатель должен иметь возможность оформить первый заказ без помощи персонала не более чем за 3 минуты.

**`NFUS2`** 95% пользователей должны успешно завершить ключевые сценарии (поиск блюда, добавление в корзину, оплата) без ошибок.

**`NFUS3`** Средний балл по шкале SUS (System Usability Scale) по результатам опроса пользователей клиентского приложения должен быть не менее 75 из 100.

**`NFUS4`** Интерфейс кассира в 1С должен блокировать возможность повторного применения скидки или отмены уже оплаченного заказа без двухуровневого подтверждения (вызов менеджера).

### Безопасность

**`NFSEC1`** Доступ к API должен осуществляться с обязательным использованием JWT-токенов. Должна быть реализована ролевая модель доступа (RBAC) для разделения прав сотрудников.

**`NFSEC2`** Все данные, передаваемые между клиентом и сервером, а также между микросервисами, должны шифроваться с использованием TLS 1.2 или выше. Пароли пользователей должны храниться в хэшированном виде (bcrypt).

**`NFSEC3`** API Gateway должен обеспечивать защиту от базовых атак (DDoS, подбор паролей, SQL-инъекции).

**`NFSEC4`** Доступ к персональным данным покупателей и истории их заказов должен быть строго регламентирован, все действия с данными должны логироваться.

**`NFSEC5`** Инфраструктура, обрабатывающая данные банковских карт (сервис оплаты), должна соответствовать требованиям PCI DSS уровня, применимого к используемому платежному шлюзу.

### Масштабируемость

**`NFSCAL1`** Архитектура системы (микросервисы) должна позволять горизонтально масштабировать каждый сервис независимо от других.

**`NFSCAL2`** Должна быть предусмотрена возможность увеличения количества партиций в топиках Apache Kafka и шардирования баз данных (например, по датам) для обработки растущего объёма данных.

**`NFSCAL3`** Система должна позволять добавлять новые способы оплаты, каналы уведомлений или модули (например, доставку) без изменения кода ядерных сервисов (через плагины или конфигурацию).

### Надежность

**`NFROB1`** Коэффициент готовности системы (доступность) должен составлять не менее 99,5% в течение календарного месяца.

**`NFROB2`** Средняя наработка на отказ (MTBF) для критического бизнес-контура (от создания заказа до его фиксации в БД) должна составлять не менее 720 часов.

**`NFROB3`** Критически важные компоненты (API Gateway, сервисы заказов и оплаты, основная база данных) должны быть развернуты в отказоустойчивой конфигурации (минимум 2 экземпляра).

**`NFROB4`** Если соединение между пользователем и системой разрывается до подтверждения заказа, система должна позволять восстановить незавершенный заказ и продолжить работу с того же шага.

### Совместимость

**`NFCOM1`** Клиентские веб-приложения должны корректно работать в последних версиях браузеров Chrome, Firefox, Safari и их мобильных аналогах.

**`NFCOM2`** Мобильное приложение должно быть совместимо с актуальными версиями ОС Android и iOS (на момент выхода приложения).

**`NFCOM3`** Бэкенд-сервисы должны быть упакованы в Docker-контейнеры, что позволяет разворачивать систему как в облачной инфраструктуре (Yandex Cloud, AWS), так и в локальном дата-центре.

**`NFCOM4`** Интеграция с внешними системами (платежные шлюзы, роботизированный комплекс, 1С, ОФД) должна осуществляться через API, предоставляемые этими системами.

### Доступность

**`NFAVL1`** Система должна быть доступна не менее 99,5% времени в течение месяца (с учётом времени планового обслуживания).

**`NFAVL2`** Плановое техническое обслуживание (обновление, резервное копирование) не должно приводить к простою более 2 часов в месяц.

**`NFAVL3`** Среднее время восстановления системы (MTTR) после сбоя уровня «сервис недоступен» не должно превышать 15 минут.

### Хранения данных

**`NFDT1`** Персональные данные пользователей должны храниться не дольше срока, установленного законодательством (152-ФЗ), и удаляться после закрытия учётной записи.

**`NFDT2`** Фискальные данные (чеки) должны храниться не менее 5 лет в соответствии с требованиями ФЗ-54.

**`NFDT3`** Заказы старше 3 лет должны автоматически перемещаться в архивное (холодное) хранилище для снижения нагрузки на операционные базы данных.

**`NFDT4`** Полное резервное копирование всех баз данных должно выполняться ежедневно, инкрементальное — ежечасно.

**`NFDT5`** Резервные копии должны храниться в географически распределённом хранилище для обеспечения сохранности при авариях.

### Концептуальная целостность

**`NFARC1`** Для синхронного взаимодействия между компонентами системы должен использоваться архитектурный стиль REST. Для асинхронного обмена — событийно-ориентированная архитектура на базе Apache Kafka.

**`NFARC2`** Все сервисы должны быть слабосвязанными и взаимодействовать через единую точку входа — API Gateway.

**`NFARC3`** Каждый микросервис должен быть независимым и иметь собственную базу данных (если требуется). 

### Поддерживаемость

**`NFSUP1`** Система должна логировать действия пользователей, критические события и ошибки. Доступ к логам должен предоставляться через графический интерфейс с возможностью фильтрации и поиска.

**`NFSUP2`** Должен быть обеспечен мониторинг производительности и состояния сервисов в реальном времени (дашборды, алерты).

**`NFSUP3`** Время развертывания новой версии одного микросервиса (включая rolling update) не должно превышать 10 минут.

**`NFSUP4`** Код должен соответствовать принятым стандартам кодстайла, уровень покрытия unit-тестами критической бизнес-логики — не менее 80%.

**`NFSUP5`** Вся конфигурация (подключения к внешним системам, параметры) должна выноситься в централизованное хранилище (Config Server, Vault), а не храниться внутри образов контейнеров.

## Требования к функциям (задачам), выполняемым системой

### User Story mapping

Основные функции системы представлены в виде [[User story mapping](https://app.holst.so/share/b/88076e88-4e70-47f7-8d50-dead7810f132)]

#### Definition of Ready (DoR) – критерии готовности пользовательской истории к началу разработки:
- История оценена командой (story points/часы).
- Чётко сформулированы Acceptance Criteria.
- Все внешние зависимости (API, данные, доступы) определены и доступны.
- История согласована с заказчиком/продукт-оунером.
- Макет/дизайн (если требуется) утверждён и доступен.

#### Definition of Done (DoD) – критерии завершённости истории:
- Код написан, отревьюван и слит в основную ветку.
- Написаны автоматические тесты (unit/integration) с покрытием не менее 80% для новой логики.
- Проведено функциональное тестирование (вручную или автотестами).
- Документация (API, пользовательская) обновлена.
- История развёрнута на тестовом стенде и принята заказчиком/тестировщиком.
- Отсутствуют критические и высокие дефекты.


### Функции MVP (Minimum Viable Product)

| ID | User Story | Приоритет | Версия | Acceptance Criteria |
|----|------------|-----------|--------|---------------------|
| **US01** | Я как **посетитель** хочу **удалить ранее добавленные позиции**, чтобы **актуализировать корзину**. | Высокий | MVP | 1. Возле каждой позиции в корзине есть кнопка удаления.<br>2. При нажатии появляется подтверждение «Удалить позицию?».<br>3. После подтверждения позиция исчезает, сумма пересчитывается.<br>4. При удалении всех позиций отображается сообщение «Корзина пуста». |
| **US02** | Я как **посетитель** хочу **выполнить подбор товаров и добавить их в корзину**, чтобы **совершить покупку**. | Высокий | MVP | 1. При нажатии «Добавить в корзину» блюдо появляется в корзине.<br>2. Счётчик товаров в иконке корзины увеличивается.<br>3. Если блюдо отсутствует (нет в наличии), кнопка неактивна и выводится сообщение.<br>4. После добавления предлагается апселлинг (популярные дополнения). |
| **US03** | Я как **посетитель** хочу **ознакомиться с меню**, чтобы **выбрать подходящее блюдо**. | Высокий | MVP | 1. Отображаются все категории блюд.<br>2. В каждой категории показаны блюда с названием, ценой, фото и кратким описанием.<br>3. При клике на блюдо открывается детальная карточка с полным составом и возможностью добавления в корзину.<br>4. Данные меню загружаются не более 2 секунд. |
| **US04** | Я как **посетитель** хочу **ознакомиться с наполнением корзины**, чтобы **выделить выбранные позиции в своем заказе**. | Высокий | MVP | 1. В корзине отображается список добавленных позиций с фото, названием, количеством, ценой за единицу и общей суммой.<br>2. Итоговая стоимость заказа пересчитывается при любых изменениях.<br>3. Есть кнопка «Оформить заказ». |
| **US07** | Я как **посетитель** хочу **ознакомиться с наполнением корзины**, чтобы **видеть выбранные позиции в своем заказе**. (дубль US04) | Высокий | MVP | 1. В корзине отображается список добавленных позиций с фото, названием, количеством, ценой за единицу и общей суммой.<br>2. Итоговая стоимость заказа пересчитывается при любых изменениях.<br>3. Есть кнопка «Оформить заказ». |
| **US08** | Я как **посетитель** хочу **оплатить заказ наличными**, чтобы **иметь возможность оплатить заказ, если нет других способов оплаты**. | Высокий | MVP | 1. При выборе оплаты картой активируется платёжный терминал или открывается форма ввода данных.<br>2. При успешной оплате заказ создаётся, присваивается номер, печатается талон.<br>3. При ошибке оплаты выводится сообщение, предлагается повторить или выбрать другой способ.<br>4. Платежи проходят через тестовый/боевой шлюз без сохранения чувствительных данных. |
| **US17** | Я как **посетитель** хочу **получить талон с номером заказа**, чтобы **получить именно свой заказ,  не держать в голове номер заказа**. | Высокий | MVP | 1. После оплаты на экране отображается номер заказа и QR-код.<br>2. Есть возможность распечатать талон (на терминале) или сохранить QR в телефон.<br>3. Заказ отправляется на кухню, система фиксирует время начала приготовления. |
| **US20** | Я как **работник производства** хочу **отслеживать актуальное состояние роботов**, чтобы **не было простоев в производстве (понимать, когда нужно тех. обслуживание)**. | Средний | Ver 2 | 1. На рабочем месте доступен дашборд с активными заказами.<br>2. Отображается очередь, время до готовности, состав.<br>3. Работник может отмечать заказы как готовые.<br>4. Дашборд обновляется в реальном времени. |
| **US21** | Я как **работник производства** хочу **отслеживать запасы полуфабрикатов**, чтобы **вовремя пополнять запасы**. | Средний | Ver 2 | 1. В интерфейсе склада отображаются остатки ингредиентов с пороговыми значениями.<br>2. При достижении порога строка выделяется цветом.<br>3. Можно сформировать заявку на пополнение (интеграция с ERP или ручной заказ). |
| **US22** | Я как **менеджер по ассортименту** хочу **настроить состав меню**, чтобы **покупатель не заказал отсутствующую позицию**. | Высокий | MVP | 1. В админ-панели доступен список всех блюд с возможностью редактирования состава (ингредиенты, описание).<br>2. Можно скрыть/показать блюдо.<br>3. Изменения сохраняются и мгновенно отображаются в клиентских интерфейсах.<br>4. Нельзя сохранить пустые обязательные поля. |
| **US27** | Я как **менеджер по гостеприимству** хочу **иметь возможность оформить отказ посетителя от заказа**, чтобы **освободить стенд для следующего посетителя / (вернуть деньги за неактуальный заказ посетителю) **.| Высокий | MVP | 1. В админ-панели доступен список всех блюд с возможностью редактирования состава (ингредиенты, описание).<br>2. Можно скрыть/показать блюдо.<br>3. Изменения сохраняются и мгновенно отображаются в клиентских интерфейсах.<br>4. Нельзя сохранить пустые обязательные поля. |

### Функции версии 2 (Ver 2)

| ID | User Story | Приоритет | Версия | Acceptance Criteria |
|----|------------|-----------|--------|---------------------|
| **US05** | Я как **посетитель** хочу **выбрать вид получения заказа "в зале"**, чтобы **получить заказ в формате, удобном для употребления блюд в зале**. | Высокий | MVP | 1. На этапе оформления предлагается опция «В зале».<br>2. Выбор обязателен, нельзя перейти к оплате без выбора.<br>3. Выбранный способ сохраняется и отображается в чеке/талоне. |
| **US06** | Я как **посетитель** хочу **выбрать вид получения заказа "с собой"**, чтобы **иметь возможность забрать заказ с собой**. | Высокий | MVP | 1. На этапе оформления предлагается опция «С собой».<br>2. Выбор обязателен, нельзя перейти к оплате без выбора.<br>3. Выбранный способ сохраняется и отображается в чеке/талоне. |
| **US09** | Я как **посетитель** хочу **оплатить заказ картой**, чтобы **иметь возможность оплатить заказ, если у меня не будет наличных**. | Средний | Ver 2 | 1. При выборе «Подарочная карта» предлагается ввести номер или отсканировать штрих-код.<br>2. Система проверяет баланс карты.<br>3. Если средств достаточно, списывает сумму и создаёт заказ.<br>4. Если недостаточно, предлагает доплатить другим способом. |
| **US11** | Я как **посетитель** хочу **авторизоваться в системе**, чтобы **воспользоваться бонусной системой перед заказом**. | Средний | Ver 2 | 1. Вход по номеру телефона и паролю или по SMS-коду.<br>2. При неверных данных выводится сообщение.<br>3. После входа отображается имя пользователя, баланс бонусов.<br>4. Сессия сохраняется минимум 7 дней. |
| **US12** | Я как **посетитель** хочу **авторизоваться в системе**, чтобы **узнать количество бонусов**. | Средний | Ver 2 | 1. Вход по номеру телефона и паролю или по SMS-коду.<br>2. При неверных данных выводится сообщение.<br>3. После входа отображается имя пользователя, баланс бонусов.<br>4. Сессия сохраняется минимум 7 дней. |
| **US18** | Я как **посетитель** хочу **иметь возможность отказаться от заказа**, чтобы **иметь возможность обжаловать некондиционный товар**. | Средний | Ver 2 | 1. При выборе «Подарочная карта» предлагается ввести номер или отсканировать штрих-код.<br>2. Система проверяет баланс карты.<br>3. Если средств достаточно, списывает сумму и создаёт заказ.<br>4. Если недостаточно, предлагает доплатить другим способом. |
| **US23** | Я как **как менеджер по ассортименту** хочу **настроить цену позиции меню**, чтобы **актуализировать цену**. | Высокий | MVP | 1. В админ-панели можно изменить цену блюда.<br>2. Цена не может быть отрицательной.<br>3. Изменения применяются мгновенно. |
| **US30** | Я как **менеджер по гостеприимству** хочу **получать уведомления о технических сбоях**, чтобы **вовремя решать возникающие проблемы (уговорить посетителей не расходиться, если технический сбой не серьезный) **. | Низкий | Ver 3 | 1. При сбоях (отключение оборудования, ошибки системы) генерируется уведомление.<br>2. Уведомление отображается в интерфейсе менеджера (и/или email/SMS).<br>3. Указывается описание проблемы и время возникновения.<br>4. При восстановлении отправляется уведомление о разрешении. |


### Функции версии 3 (Ver 3)

| ID | User Story | Приоритет | Версия | Acceptance Criteria |
|----|------------|-----------|--------|---------------------|
| **US10** | Я как **посетитель** хочу **оплатить заказ Qr кодом**, чтобы **получать кэшбек за свои заказы в ресторане**. | Средний | Ver 2 | 1. При выборе «Подарочная карта» предлагается ввести номер или отсканировать штрих-код.<br>2. Система проверяет баланс карты.<br>3. Если средств достаточно, списывает сумму и создаёт заказ.<br>4. Если недостаточно, предлагает доплатить другим способом. |
| **US13** | Я как **посетитель** хочу **иметь возможность зарегистрироваться в системе**, чтобы **экономить на бонусах**. | Средний | Ver 2 | 1. Форма регистрации: номер телефона, имя (опционально), пароль.<br>2. Подтверждение номера через SMS.<br>3. После подтверждения пользователь автоматически авторизуется.<br>4. Нельзя зарегистрироваться с уже существующим номером без восстановления. |
| **US14** | Я как **посетитель** хочу **воспользоваться бонусной системой**, чтобы **покупать блюда дешевле**. | Средний | Ver 2 | 1. На экране оплаты отображается текущий баланс и опция списания.<br>2. Можно ввести количество баллов или выбрать «Списать максимум».<br>3. Сумма заказа пересчитывается с учётом скидки (1 балл = 1 рубль или другой курс).<br>4. После оплаты начисляются новые баллы за заказ. |
| **US15** | Я как **посетитель** хочу **иметь возможность видеть условие получения подарка**, чтобы **иметь возможность выполнить условие для его получения**. | Высокий | MVP | 1. В корзине отображается список добавленных позиций с фото, названием, количеством, ценой за единицу и общей суммой.<br>2. Итоговая стоимость заказа пересчитывается при любых изменениях.<br>3. Есть кнопка «Оформить заказ». |
| **US16** | Я как **посетитель** хочу **иметь возможность видеть условие получения скидки**, чтобы **иметь возможность выполнить условие для её получения**. | Высокий | MVP | 1. В корзине отображается список добавленных позиций с фото, названием, количеством, ценой за единицу и общей суммой.<br>2. Итоговая стоимость заказа пересчитывается при любых изменениях.<br>3. Есть кнопка «Оформить заказ». |
| **US19** | Я как **посетитель** хочу **видеть информацию о готовности заказа на информационном табло**, чтобы **знать о готовности заказа**. | Средний | Ver 2 | 1. На сайте доступна форма предзаказа с выбором блюд и способа получения.<br>2. После оформления заказ поступает в систему и получает номер.<br>3. Посетитель может отслеживать статус заказа на сайте.<br>4. При изменении статуса (готов, выдан) посетитель получает уведомление (на сайте или email). |
| **US24** | Я как **как менеджер по ассортименту** хочу **изменять маркетинговые акции**, чтобы ** актуализировать их для покупателя (в магазине были представлены актуальные акции)**. | Средний | Ver 2 | 1. В админ-панели раздел «Акции и комбо».<br>2. Можно создать акцию (процент скидки, фиксированная сумма, условие «от N позиций»).<br>3. Акции применяются к корзине автоматически при выполнении условий. |
| **US25** | Я как **как менеджер по ассортименту** хочу **изменить комплексные предложения**, чтобы **вовремя настроить меню для покупателя**. | Средний | Ver 2 | 1. В админ-панели можно создать комбо-набор из нескольких блюд со специальной ценой.<br>2. Комбо отображается в меню как отдельная позиция.<br>3. При добавлении в корзину учитываются все позиции комплекса. |
| **US26** | Я как **как менеджер по ассортименту** хочу **настроить тех карту**, чтобы **видеть изменения рецепта блюда**. | Низкий | Ver 3 | 1. В интерфейсе заказа доступна операция возврата наличных.<br>2. При выборе возврата открывается денежный ящик.<br>3. Статус заказа меняется на «Возврат», фиксируется сумма и время.<br>4. Операция логируется. |
| **US28** | Я как **менеджер по гостеприимству** хочу **оформить возврат наличных денежных средств посетителю**, чтобы **посетитель получил средства за отмененный заказ**. | Низкий | Ver 3 | 1. В интерфейсе заказа доступна кнопка «Возврат наличных».<br>2. Система открывает денежный ящик и фиксирует операцию.<br>3. Статус заказа обновляется на «Возврат». |
| **US29** | Я как **менеджер по гостеприимству** хочу **оформить возврат денежных средств по карте посетителю**, чтобы **посетитель получил средства за отмененный заказ**. | Низкий | Ver 3 | 1. В интерфейсе заказа доступна кнопка «Возврат на карту».<br>2. Система инициирует транзакцию через платежный шлюз.<br>3. При успехе статус заказа меняется на «Возврат».<br>4. При ошибке выводится сообщение. |
| **US31** | Я как **менеджер по гостеприимству** хочу **получать уведомления о выводе позиций из меню**, чтобы **владеть актуальной информацией по меню**. | Низкий | Ver 3 | 1. Если заказ готов более заданного времени (например, 2 минуты), работник кухни получает напоминание о выдаче.<br>2. Уведомление дублируется звуковым сигналом.<br>3. После подтверждения выдачи уведомление исчезает. |

---

> **Примечание:** Приведённые User Story охватывают все уникальные сценарии из предоставленного материала. Повторяющиеся истории были объединены. DoR и DoD являются общими для всех историй и применяются ко всем задачам в рамках разработки. Acceptance Criteria для каждой истории конкретизируют условия успешной реализации.