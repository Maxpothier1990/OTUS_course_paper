# Требования к системе

## Требования к системе в целом (Нефункциональные требования)

### Производительность

**`NFPER1`** Система должна обслуживать нем менее 100 пользователей в период пиковой активности с 8:00 до 22:00 по местному времени, со средней продолжительностью сеанса 5 минут.  

**`NFPER2`** Все веб-страницы, генерируемые системой, должны полностью загружаться не более чем за 5 секунды после запроса их по интернет-подключению со скоростью 20 Мбит/сек.  

**`NFPER3`** Система должна выводить пользователю сообщение о подтверждении в среднем за 3 секунды и не более чем через 6 секунд после того, как пользователь отослал информацию системе. 

**`NFPER4`** Система должна обрабатывать до 30 новых заказов в минуту в часы пик без деградации времени отклика, указанного в NFPER3.

**`NFPER5`** Время отклика системы на любом клиентском интерфейсе при пиковой нагрузке (100 одновременных активных сессий) не должно превышать 2 секунд в 95% запросов.

**`NFPER6`** В режиме технического обслуживания система должна позволять завершать текущие транзакции, но блокировать создание новых заказов.

### Удобство использования

**`NFUS1`** Покупатель должен иметь возможность оформить первый заказ без помощи персонала не более чем за 3 минуты.

**`NFUS2`** 95% пользователей должны успешно завершить ключевые сценарии (поиск блюда, добавление в корзину, оплата) без ошибок.

**`NFUS3`** Средний балл по шкале SUS (System Usability Scale) по результатам опроса пользователей клиентского приложения должен быть не менее 75 из 100.

**`NFUS4`** Интерфейс кассира в 1С должен блокировать возможность повторного применения скидки или отмены уже оплаченного заказа без двухуровневого подтверждения (вызов менеджера).

### Безопасность

**`NFSEC1`** Доступ к API должен осуществляться с обязательным использованием JWT-токенов. Должна быть реализована ролевая модель доступа (RBAC) для разделения прав сотрудников.

**`NFSEC2`** Все данные, передаваемые между клиентом и сервером, а также между микросервисами, должны шифроваться с использованием TLS 1.2 или выше. Пароли пользователей должны храниться в хэшированном виде (bcrypt).

**`NFSEC3`** API Gateway должен обеспечивать защиту от базовых атак (DDoS, подбор паролей, SQL-инъекции).

**`NFSEC4`** Доступ к персональным данным покупателей и истории их заказов должен быть строго регламентирован, все действия с данными должны логироваться.

**`NFSEC5`** Инфраструктура, обрабатывающая данные банковских карт (сервис оплаты), должна соответствовать требованиям PCI DSS уровня, применимого к используемому платежному шлюзу.

### Масштабируемость

**`NFSCAL1`** Архитектура системы (микросервисы) должна позволять горизонтально масштабировать каждый сервис независимо от других.

**`NFSCAL2`** Должна быть предусмотрена возможность увеличения количества партиций в топиках Apache Kafka и шардирования баз данных (например, по датам) для обработки растущего объёма данных.

**`NFSCAL3`** Система должна позволять добавлять новые способы оплаты, каналы уведомлений или модули (например, доставку) без изменения кода ядерных сервисов (через плагины или конфигурацию).

### Надежность

**`NFROB1`** Коэффициент готовности системы (доступность) должен составлять не менее 99,5% в течение календарного месяца.

**`NFROB2`** Средняя наработка на отказ (MTBF) для критического бизнес-контура (от создания заказа до его фиксации в БД) должна составлять не менее 720 часов.

**`NFROB3`** Критически важные компоненты (API Gateway, сервисы заказов и оплаты, основная база данных) должны быть развернуты в отказоустойчивой конфигурации (минимум 2 экземпляра).

**`NFROB4`** Если соединение между пользователем и системой разрывается до подтверждения заказа, система должна позволять восстановить незавершенный заказ и продолжить работу с того же шага.

### Совместимость

**`NFCOM1`** Клиентские веб-приложения должны корректно работать в последних версиях браузеров Chrome, Firefox, Safari и их мобильных аналогах.

**`NFCOM2`** Мобильное приложение должно быть совместимо с актуальными версиями ОС Android и iOS (на момент выхода приложения).

**`NFCOM3`** Бэкенд-сервисы должны быть упакованы в Docker-контейнеры, что позволяет разворачивать систему как в облачной инфраструктуре (Yandex Cloud, AWS), так и в локальном дата-центре.

**`NFCOM4`** Интеграция с внешними системами (платежные шлюзы, роботизированный комплекс, 1С, ОФД) должна осуществляться через API, предоставляемые этими системами.

### Доступность

**`NFAVL1`** Система должна быть доступна не менее 99,5% времени в течение месяца (с учётом времени планового обслуживания).

**`NFAVL2`** Плановое техническое обслуживание (обновление, резервное копирование) не должно приводить к простою более 2 часов в месяц.

**`NFAVL3`** Среднее время восстановления системы (MTTR) после сбоя уровня «сервис недоступен» не должно превышать 15 минут.

### Хранения данных

**`NFDT1`** Персональные данные пользователей должны храниться не дольше срока, установленного законодательством (152-ФЗ), и удаляться после закрытия учётной записи.

**`NFDT2`** Фискальные данные (чеки) должны храниться не менее 5 лет в соответствии с требованиями ФЗ-54.

**`NFDT3`** Заказы старше 3 лет должны автоматически перемещаться в архивное (холодное) хранилище для снижения нагрузки на операционные базы данных.

**`NFDT4`** Полное резервное копирование всех баз данных должно выполняться ежедневно, инкрементальное — ежечасно.

**`NFDT5`** Резервные копии должны храниться в географически распределённом хранилище для обеспечения сохранности при авариях.

### Концептуальная целостность

**`NFARC1`** Для синхронного взаимодействия между компонентами системы должен использоваться архитектурный стиль REST. Для асинхронного обмена — событийно-ориентированная архитектура на базе Apache Kafka.

**`NFARC2`** Все сервисы должны быть слабосвязанными и взаимодействовать через единую точку входа — API Gateway.

**`NFARC3`** Каждый микросервис должен быть независимым и иметь собственную базу данных (если требуется). 

### Поддерживаемость

**`NFSUP1`** Система должна логировать действия пользователей, критические события и ошибки. Доступ к логам должен предоставляться через графический интерфейс с возможностью фильтрации и поиска.

**`NFSUP2`** Должен быть обеспечен мониторинг производительности и состояния сервисов в реальном времени (дашборды, алерты).

**`NFSUP3`** Время развертывания новой версии одного микросервиса (включая rolling update) не должно превышать 10 минут.

**`NFSUP4`** Код должен соответствовать принятым стандартам кодстайла, уровень покрытия unit-тестами критической бизнес-логики — не менее 80%.

**`NFSUP5`** Вся конфигурация (подключения к внешним системам, параметры) должна выноситься в централизованное хранилище (Config Server, Vault), а не храниться внутри образов контейнеров.

## Требования к функциям (задачам), выполняемым системой

### User Story диаграмма

Основные функции системы представлены в виде User story mapping.  

[[ссылке](https://app.holst.so/board/9f0d42f8-4105-432a-a045-a35bc6129e56)]

### Описание User story, реализуемых в рамках MVP
